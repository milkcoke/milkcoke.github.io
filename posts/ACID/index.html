<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="ACID" /><meta property="og:locale" content="en" /><meta name="description" content="ACID principal Atomicity Consistency Isolation Durability" /><meta property="og:description" content="ACID principal Atomicity Consistency Isolation Durability" /><link rel="canonical" href="https://milkcoke.github.io/posts/ACID/" /><meta property="og:url" content="https://milkcoke.github.io/posts/ACID/" /><meta property="og:site_name" content="Falcon Database" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-11T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="ACID" /><meta name="twitter:site" content="@M_Milkcoke" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-28T16:34:04+09:00","datePublished":"2022-08-11T00:00:00+09:00","description":"ACID principal Atomicity Consistency Isolation Durability","headline":"ACID","mainEntityOfPage":{"@type":"WebPage","@id":"https://milkcoke.github.io/posts/ACID/"},"url":"https://milkcoke.github.io/posts/ACID/"}</script><title>ACID | Falcon Database</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Falcon Database"><meta name="application-name" content="Falcon Database"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/profile/m_falcon_logo-modified.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Falcon Database</a></div><div class="site-subtitle font-italic">Focus fundamental, Focus reducing the cost of time & money</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/milkcoke" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/M_Milkcoke" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mbh023','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>ACID</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>ACID</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1660143600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 11, 2022 </em> </span> <span> Updated <em class="" data-ts="1666942444" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 28, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/M_Milkcoke">M_Falcon</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="485 words"> <em>2 min</em> read</span></div></div></div><div class="post-content"><h1 id="acid-principal">ACID principal</h1><ul><li>Atomicity<li>Consistency<li>Isolation<li>Durability</ul><h2 id="atomicity"><span class="mr-2">Atomicity</span><a href="#atomicity" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>A minimum unit of job which can’t be split. <br /> If any failure, all queries in a transaction should be rollback .</p><h2 id="isolation"><span class="mr-2">Isolation</span><a href="#isolation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="dirty-read"><span class="mr-2">Dirty read</span><a href="#dirty-read" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Two transactions tx1, tx2 are executing in parallel <br /> Tx1 read something <br /> Tx2 write something <br /> When Tx1 read something after tx2 write something but tx2 rollback afterwards. <br /> Tx1 might read consistent data that is dirty value</p><p>This is dirty read.</p><h3 id="non-repeatable-read"><span class="mr-2">Non-repeatable read</span><a href="#non-repeatable-read" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>After tx2 write something, tx1 read after tx2 <code class="language-plaintext highlighter-rouge">commit()</code>. So tx1 read updated and inconsistent value <br /> Tx1 should only read the status of data at the specific point for ensuring consistent.</p><h3 id="phantom-read"><span class="mr-2">Phantom read</span><a href="#phantom-read" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>After tx2 write something, tx1 read after tx2 <code class="language-plaintext highlighter-rouge">commit()</code>. so tx1 read new value. <br /> Tx1 should only read the status of data at the specific point for ensuring consistent.</p><h3 id="lost-update"><span class="mr-2">Lost update</span><a href="#lost-update" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Tx1 update some record and at the same time, Tx1 update same record. <br /> One of them, one transaction’s update should be abandoned.</p><h2 id="isolation-level"><span class="mr-2">Isolation Level</span><a href="#isolation-level" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="read-uncommitted"><span class="mr-2">Read uncommitted</span><a href="#read-uncommitted" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>No isolation</strong>, any change from the outside is visible to the transaction, regardless of <code class="language-plaintext highlighter-rouge">commit()</code> <br /> Dirty read is allowed, although it’s fast.</p><h3 id="read-committed"><span class="mr-2">Read committed</span><a href="#read-committed" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Each query can only see after outside transaction is committed. <br /> Dirty read is denied.</p><h3 id="repeatable-read"><span class="mr-2">Repeatable Read</span><a href="#repeatable-read" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The read data remain unchanged while reading transaction is running. <br /> This denys non-repeatable read.</p><h3 id="snapshot"><span class="mr-2">Snapshot</span><a href="#snapshot" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Transaction can only see changes that have been committed from the start of the transaction. <br /> This resolves every read isolation phenomenon.</p><h3 id="serializable"><span class="mr-2">Serializable</span><a href="#serializable" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>All transactions must be executed isolated.</p><div class="table-wrapper"><table><thead><tr><th>Isolation Level<th>Dirty read<th>Non-repeatable read<th>Phantom<th>Lost Update<tbody><tr><td>Read Uncommitted<td>may occur<td>may occur<td>may occur<td>may occur<tr><td>Read Committed<td>don’t occur<td>may occur<td>may occur<td>may occur<tr><td>Repeatable Read<td>don’t occur<td>don’t occur<td>may occur<td>don’t occur<tr><td>Serializable<td>don’t occur<td>don’t occur<td>don’t occur<td>don’t occur</table></div><blockquote><p>⚠️In Repeatable Read, when a row inserted in the middle of transaction but new record is not locked and visible to transaction. So phantom may occur.</p></blockquote><p>DBMS implements isolation level differently.</p><h2 id="consistency"><span class="mr-2">Consistency</span><a href="#consistency" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Defined by DBA, Referential integrity (Foreign key)</p><h3 id="eventual-consistency"><span class="mr-2">Eventual consistency</span><a href="#eventual-consistency" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Allow some inconsistency like below. <br /> Master node (Write Only) and slave node (Read Only) has some data inconsistency during synchronization.</p><h2 id="durability"><span class="mr-2">Durability</span><a href="#durability" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This make DBMS non-volatile, persisted system even if there’s a rash. <br /> Data is persistent and has failover mechanism.</p><h4 id="write-ahead-log-wal"><span class="mr-2">Write Ahead Log (WAL)</span><a href="#write-ahead-log-wal" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Write data in write-ahead-log segments (compressed version). <br /> DB keeps change logs in undo logs in replica status. It makes slower</p><h4 id="os-cache"><span class="mr-2">OS Cache</span><a href="#os-cache" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>A write request in OS usually goes to the OS cache since it wants flush many data reducing the number of dispatch to disk. <br /> This decides where a transaction writes the data in OS cache or disk.</p><h4 id="asynchronous-snapshot"><span class="mr-2">Asynchronous snapshot</span><a href="#asynchronous-snapshot" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><h4 id="append-only-file-aof"><span class="mr-2">Append Only File (AOF)</span><a href="#append-only-file-aof" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><h3 id="redis-durability"><span class="mr-2">Redis durability</span><a href="#redis-durability" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>Redis support <strong>Asynchronous snapshot</strong> and <strong>AOF</strong> both. <br /> Snapshots in redis are generated in background process which is forked. This is quite expensive. AOF is slower than snapshots since the size of the AOF file is continuously going to grow over time</p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/database/'>Database</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/database/" class="post-tag no-text-decoration" >database</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=ACID+-+Falcon+Database&url=https%3A%2F%2Fmilkcoke.github.io%2Fposts%2FACID%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=ACID+-+Falcon+Database&u=https%3A%2F%2Fmilkcoke.github.io%2Fposts%2FACID%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fmilkcoke.github.io%2Fposts%2FACID%2F&text=ACID+-+Falcon+Database" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Concurrency/">Concurrency in redis</a><li><a href="/posts/Hyper_loglog/">HyperLogLog</a><li><a href="/posts/Hash_data/">Tips about Hash commands</a><li><a href="/posts/Clustered_vs_Non-Clustered/">Clustered index vs non-clustered index</a><li><a href="/posts/Postgres_vs_MySQL/">Which one to choose between Postgres and MySQL</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/redis/">Redis</a> <a class="post-tag" href="/tags/cache/">cache</a> <a class="post-tag" href="/tags/nosql/">nosql</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Locking/"><div class="card-body"> <em class="small" data-ts="1690210800" data-df="ll" > Jul 25, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Locking</h3><div class="text-muted small"><p> Exclusive Lock Usually, write. It’s like a mutex lock Lifetime In a single transaction Only one transaction can get exclusive lock. Shared Lock Usually, read. Lifetime In multiple transactions ...</p></div></div></a></div><div class="card"> <a href="/posts/eventual_consistency/"><div class="card-body"> <em class="small" data-ts="1660575600" data-df="ll" > Aug 16, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Strong vs Eventual Consistency</h3><div class="text-muted small"><p> Strong Consistency “Always all data is to have integrity” Eventual Consistency This ensures all read operations retrieves updated data at the end. Master Node + Read replica I...</p></div></div></a></div><div class="card"> <a href="/posts/page_and_IO/"><div class="card-body"> <em class="small" data-ts="1660575600" data-df="ll" > Aug 16, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Required terms of database</h3><div class="text-muted small"><p> Pages The logical unit, that of database stores and reads the data. Different according to DBMS (ex. PostgreSQL has a 8KB page, MySQL does 16KB) DB handle data one or more pages in a single IO. ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"><div class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></div><a href="/posts/eventual_consistency/" class="btn btn-outline-primary" prompt="Newer"><p>Strong vs Eventual Consistency</p></a></div><script src="https://utteranc.es/client.js" repo="milkcoke/blog-comments" issue-term="title" crossorigin="anonymous" async> </script> <script type="text/javascript"> $(function() { const origin = "https://utteranc.es"; const iframe = "iframe.utterances-frame"; const lightTheme = "github-light"; const darkTheme = "github-dark"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } addEventListener("message", (event) => { let theme; /* credit to <https://github.com/utterance/utterances/issues/170#issuecomment-594036347> */ if (event.origin === origin) { /* page initial */ theme = initTheme; } else if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); } else { return; } const message = { type: "set-theme", theme: theme }; const utterances = document.querySelector(iframe).contentWindow; utterances.postMessage(message, origin); }); }); </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/M_Milkcoke">M_Falcon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/redis/">Redis</a> <a class="post-tag" href="/tags/cache/">cache</a> <a class="post-tag" href="/tags/nosql/">nosql</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
